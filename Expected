pipeline {
    agent any

    stages {
        stage('Abort and Delete Build') {
            steps {
                script {
                    call(true) // Pass true to execute the function
                }
            }
        }
    }
}

def call(Boolean permitExecute) {
    if (permitExecute) {
        def currentBuildNumber = env.BUILD_NUMBER.toInteger()
        def jenkinsInst = jenkins.model.Jenkins.instance
        def currentJob = jenkinsInst.getItemByFullName(env.JOB_NAME)

        currentBuild.result = 'ABORTED'
        currentBuild.keepLog = false

        sleep(5)  // Sleep for 5 seconds

        println("currentBuild.result: ${currentBuild.result}")

        currentJob.getBuildByNumber(currentBuildNumber)?.delete()
    }
}
